<div class="container py-5 mb-5">
    
    {{!-- 1. HEADER & T√åM KI·∫æM --}}
    <div class="row align-items-center mb-4 g-3">
        <div class="col-md-5">
            <h2 class="fw-bold text-primary mb-1">
                <i class="fas fa-store me-2"></i>C·ª≠a h√†ng
            </h2>
            <p class="text-muted mb-0">
                <a href="/customer" class="text-decoration-none text-secondary hover-link">
                    <i class="fas fa-arrow-left me-1"></i>V·ªÅ trang ch√≠nh
                </a>
            </p>
        </div>
        <div class="col-md-7">
            <form action="/customer/products" method="GET">
                <div class="input-group shadow-sm rounded-pill overflow-hidden border">
                    <span class="input-group-text bg-white border-0 ps-3"><i class="fas fa-search text-muted"></i></span>
                    <input type="text" class="form-control border-0 py-2" 
                           name="keyword" placeholder="T√¨m t√™n thu·ªëc, th·ª©c ƒÉn, ph·ª• ki·ªán..." 
                           value="{{keyword}}">
                    <button class="btn btn-primary px-4 fw-bold" type="submit">T√¨m ki·∫øm</button>
                </div>
            </form>
        </div>
    </div>

    {{!-- 2. FORM MUA H√ÄNG --}}
    <form method="POST" action="/customer/checkout">
        
        <div class="card shadow-sm border-0 overflow-hidden mb-5">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-secondary">
                        <tr>
                            <th scope="col" class="py-3 ps-4">S·∫£n ph·∫©m</th>
                            <th scope="col" class="py-3 text-end">ƒê∆°n gi√°</th>
                            <th scope="col" class="py-3 text-center">T·ªìn kho</th>
                            <th scope="col" class="py-3 pe-4 text-end" style="width: 140px;">S·ªë l∆∞·ª£ng</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#if products.length}}
                            {{#each products}}
                            <tr>
                                {{!-- T√™n s·∫£n ph·∫©m --}}
                                <td class="ps-4">
                                    <div class="d-flex align-items-center">
                                        <div class="bg-primary bg-opacity-10 text-primary rounded p-2 me-3">
                                            <i class="fas fa-box"></i>
                                        </div>
                                        <div>
                                            <h6 class="fw-bold text-dark mb-0">{{this.product_name}}</h6>
                                            {{!-- N·∫øu c√≥ lo·∫°i s·∫£n ph·∫©m th√¨ hi·ªán, kh√¥ng th√¨ ·∫©n --}}
                                            {{#if this.product_type}}
                                                <small class="text-muted">{{this.product_type}}</small>
                                            {{/if}}
                                        </div>
                                    </div>
                                </td>

                                {{!-- Gi√° ti·ªÅn --}}
                                <td class="text-end fw-bold text-success price-format" data-price="{{this.selling_price}}">
                                    {{this.selling_price}}
                                </td>

                                {{!-- T·ªìn kho --}}
                                <td class="text-center">
                                    {{#if this.stock_quantity}}
                                        <span class="badge bg-light text-dark border">
                                            C√≤n {{this.stock_quantity}}
                                        </span>
                                    {{else}}
                                        <span class="badge bg-danger">H·∫øt h√†ng</span>
                                    {{/if}}
                                </td>

                                {{!-- Input S·ªë l∆∞·ª£ng --}}
                                <td class="pe-4">
                                    {{#if this.stock_quantity}}
                                        <input type="number" 
                                               class="form-control text-center fw-bold bg-light" 
                                               name="qty_{{this.product_id}}" 
                                               min="0" 
                                               max="{{this.stock_quantity}}" 
                                               placeholder="0">
                                    {{else}}
                                        <input type="text" class="form-control text-center" disabled value="-" style="background-color: #f8f9fa;">
                                    {{/if}}
                                </td>
                            </tr>
                            {{/each}}
                        {{else}}
                            <tr>
                                <td colspan="4" class="text-center py-5 text-muted">
                                    <i class="fas fa-box-open fa-3x mb-3 opacity-50"></i>
                                    <p>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</p>
                                </td>
                            </tr>
                        {{/if}}
                    </tbody>
                </table>
            </div>
        </div>

        {{!-- 3. THANH THANH TO√ÅN C·ªê ƒê·ªäNH (Sticky Bottom) --}}
        <div class="fixed-bottom bg-white border-top shadow py-3" style="z-index: 1000;">
            <div class="container">
                <div class="row align-items-center g-2">
                    
                    {{!-- Ch·ªçn Ph∆∞∆°ng th·ª©c thanh to√°n --}}
                    <div class="col-md-6 d-flex align-items-center">
                        <label class="fw-bold me-3 text-nowrap"><i class="fas fa-wallet me-1 text-secondary"></i> Thanh to√°n:</label>
                        <select name="payment_method" class="form-select rounded-pill border-secondary border-opacity-25" style="max-width: 250px;">
                            <option value="Cash" data-icon="fas fa-money-bill-wave">üíµ Ti·ªÅn m·∫∑t</option>
                            <option value="Bank Transfer" data-icon="fas fa-university">üè¶ Chuy·ªÉn kho·∫£n</option>
                            <option value="QR" data-icon="fas fa-qrcode">üì± QR Code</option>
                        </select>
                    </div>

                    {{!-- N√∫t Mua H√†ng --}}
                    <div class="col-md-6 text-md-end">
                        <button type="submit" class="btn btn-primary btn-lg rounded-pill px-5 shadow hover-lift">
                            <i class="fas fa-shopping-cart me-2"></i>Mua ngay
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </form>
</div>

{{!-- SCRIPT & STYLE --}}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Format ti·ªÅn t·ªá Vi·ªát Nam
        document.querySelectorAll('.price-format').forEach(el => {
            const price = parseFloat(el.getAttribute('data-price'));
            if (!isNaN(price)) {
                el.innerText = price.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
            }
        });
    });
</script>

<style>
    /* ·∫®n n√∫t tƒÉng gi·∫£m c·ªßa input number */
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
        -webkit-appearance: none; 
        margin: 0; 
    }
    
    /* ƒê·∫©y body l√™n ƒë·ªÉ kh√¥ng b·ªã thanh sticky che m·∫•t n·ªôi dung cu·ªëi */
    body {
        padding-bottom: 100px;
    }

    .hover-lift {
        transition: transform 0.2s;
    }
    .hover-lift:hover {
        transform: translateY(-2px);
    }
    
    .hover-link:hover {
        text-decoration: underline !important;
        color: #0d6efd !important;
    }
</style>