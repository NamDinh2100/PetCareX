{{#section 'css'}}
<style>
    .login-container {
        /* Đặt chiều cao tối thiểu bằng màn hình trừ đi header */
        min-height: 85vh; 
        background-image: url('/static/images/bg.png'); 
        background-size: cover;
        background-position: center center;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.75); /* Màu trắng trong suốt */
        backdrop-filter: blur(12px); /* Hiệu ứng làm mờ nền phía sau */
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        border-radius: 24px;
    }

    .form-control-glass {
        background: rgba(255, 255, 255, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 50px;
        padding: 12px 20px;
    }
    
    .form-control-glass:focus {
        background: #fff;
        box-shadow: 0 0 0 4px rgba(45, 91, 255, 0.1);
        border-color: #2d5bff;
    }

    .alert {
        border-radius: 15px;
        border: none;
        padding: 15px 20px;
        margin-bottom: 20px;
    }

    .alert-danger {
        background: rgba(220, 53, 69, 0.1);
        color: #dc3545;
        border-left: 4px solid #dc3545;
    }

    .alert-success {
        background: rgba(25, 135, 84, 0.1);
        color: #198754;
        border-left: 4px solid #198754;
    }

    .loading-spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid #ffffff;
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 10px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{{/section}}

<div class="login-container px-3">
    <div class="card glass-card p-4 p-md-5" style="max-width: 420px; width: 100%;">
        
        <div class="text-center mb-4">
            <div class="mb-3">
                <i class="bi bi-key-fill text-primary display-4"></i>
            </div>
            <h3 class="fw-bold" style="color: #333; font-family: 'Abhaya Libre', serif;">Forgot Password?</h3>
            <p class="text-secondary small">Enter your email address and we'll send you a new password</p>
        </div>

        {{#if error}}
        <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            {{error}}
        </div>
        {{/if}}

        {{#if success}}
        <div class="alert alert-success" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            {{success}}
        </div>
        {{/if}}

        <form id="forgotPasswordForm" method="POST" action="/forgot-password">
            <div class="mb-4">
                <input type="email" 
                       class="form-control form-control-glass" 
                       id="email" 
                       name="email" 
                       placeholder="Email Address"
                       required>
            </div>

            <button type="submit" class="btn btn-primary rounded-pill w-100 py-3 fw-bold shadow-sm mb-3"
                style="background-color: #2d5bff; border: none;" id="submitBtn">
                <span id="submitText">SEND NEW PASSWORD</span>
                <div class="loading-spinner d-inline-block" id="loadingSpinner"></div>
            </button>

            <div class="text-center border-top pt-3 border-secondary-subtle">
                <span class="text-secondary small">Remember your password?</span>
                <a href="/signin" class="text-primary text-decoration-none fw-bold small ms-1">Back to Sign In</a>
            </div>
        </form>
    </div>
</div>

{{#section 'js'}}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.querySelector('input[name="email"]').value;
        
        if (!email) {
            Swal.fire({
                title: 'Error!',
                text: 'Please enter your email address.',
                icon: 'error',
                confirmButtonText: 'OK'
            });
            return;
        }
        
        Swal.fire({
            title: 'Email Sent!',
            text: 'Password reset instructions have been sent to your email.',
            icon: 'success',
            confirmButtonText: 'OK'
        }).then(() => {
            e.target.submit();
        });
    });
</script>
{{/section}}

{{#section 'js'}}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgotPasswordForm');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const emailInput = document.getElementById('email');

    // Auto-hide alerts after 5 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.opacity = '0';
            alert.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
                alert.remove();
            }, 500);
        }, 5000);
    });

    // Form submission handling
    form.addEventListener('submit', function(e) {
        // Show loading state
        submitBtn.disabled = true;
        submitText.textContent = 'SENDING...';
        loadingSpinner.style.display = 'inline-block';
        
        // Validate email
        const email = emailInput.value.trim();
        if (!email) {
            e.preventDefault();
            showError('Please enter your email address.');
            resetSubmitButton();
            return;
        }

        if (!isValidEmail(email)) {
            e.preventDefault();
            showError('Please enter a valid email address.');
            resetSubmitButton();
            return;
        }
    });

    function resetSubmitButton() {
        submitBtn.disabled = false;
        submitText.textContent = 'SEND NEW PASSWORD';
        loadingSpinner.style.display = 'none';
    }

    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    function showError(message) {
        // Remove existing alerts
        const existingAlerts = document.querySelectorAll('.alert');
        existingAlerts.forEach(alert => alert.remove());

        // Create new error alert
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger';
        alertDiv.innerHTML = `
            <i class="bi bi-exclamation-triangle me-2"></i>
            ${message}
        `;
        
        // Insert after header, before form
        const header = form.previousElementSibling;
        header.insertAdjacentElement('afterend', alertDiv);
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            alertDiv.style.opacity = '0';
            alertDiv.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
                alertDiv.remove();
            }, 500);
        }, 5000);
    }

    // Enhanced input validation feedback
    emailInput.addEventListener('blur', function() {
        const email = this.value.trim();
        if (email && !isValidEmail(email)) {
            this.style.borderColor = '#dc3545';
            this.style.boxShadow = '0 0 0 4px rgba(220, 53, 69, 0.1)';
        } else {
            this.style.borderColor = '';
            this.style.boxShadow = '';
        }
    });

    emailInput.addEventListener('input', function() {
        // Reset border color when user starts typing
        this.style.borderColor = '';
        this.style.boxShadow = '';
    });
});
</script>
{{/section}}
